/*jshint devel:true */// Define configuration object to get settings data from backend to frontend.
// Before calls are made to the backend.
var IKFrontend=IKFrontend||{settings:{}},IK=function(){"use strict";function n(e,t){this.propreties={};this.__construct(e,t)}function r(e){this.token=undefined;this.slides=[];this.currentSlide=0;this.timeout=undefined;this.__construct=function(e){this.token=e;this.fetchChannel()};this.fetchChannel=function(){a("Trying to fetch channel with token: "+this.token);$.ajax({type:"POST",context:this,url:"/channels/"+this.token+"/update",dataType:"JSON",success:function(e){this.processChannel(e)}})};this.processChannel=function(e){a("Channel with token "+this.token+" fetched.");var t=this;$.each(e,function(e,r){var i=new n(t.token,r.nid);t.slides.push(i)});$("body").ajaxStop(function(){a("All slides for the channel ("+t.token+") fechted");t.start()})};this.nextSlide=function(){var e=this,t=e.slides[e.currentSlide];t.render();this.timeout=setTimeout(function(){e.currentSlide++;if(e.currentSlide===e.slides.length){e.currentSlide=0;a("Restarting the channel to first slide")}e.nextSlide()},parseInt(t.get("exposure"),10))};this.start=function(){a("Starting the show");this.nextSlide()};this.stop=function(){a("Stopping the show");clearTimeout(this.timeout)};this.destory=function(){};this.__construct(e)}function i(e){t===undefined?t=new r(e):t.start()}function s(){t.stop()}function o(){t.destory()}function u(){e.debug=!e.debug;console.log("Debug: "+e.debug)}function a(t){e.debug===!0&&console.log(t)}var e={debug:!1},t;n.prototype.__construct=function(e,t){this.token=e;this.sid=t;this.directive={".image-container li":{"medium<-media":{"img@src":"medium"}},".slide-heading":"title",".slide-subheading":"subheading",".slide-text":"text"};this.template=$("#pure-template").compile(this.directive);this.fetchSlide()};n.prototype.fetchSlide=function(){a("Trying to fetch slide: "+this.sid);$.ajax({type:"POST",url:"/channels/"+this.token+"/slide/"+this.sid,context:this,dataType:"JSON",success:function(e){this.processSlide(e)}})};n.prototype.processSlide=function(e){a("Slide "+this.sid+" fetched.");this.propreties=e};n.prototype.get=function(e){if(this.propreties[e]!==undefined)return this.propreties[e];a("Slide failed to get property: "+e);return undefined};n.prototype.render=function(){var e=$(this.template(this.propreties));e.attr("id","slide-"+this.get("sid"));e.addClass(this.get("layout"));$("#slide-container").html(e);$("#slide-container .image-container").skitter({fullscreen:!1,numbers:!1,navigation:!1,label:!1,stop_over:!1,interval:Math.floor(this.get("exposure")/this.get("media").length),structure:'<div class="container_skitter"><div class="image"><a href=""><img class="image_main" /></a></div></div>'});a("Slide render: "+this.get("title"))};return{start:i,stop:s,destory:o,debug:u}}();(function(e){e(document).ready(function(){IK.debug();IK.start(IKFrontend.settings.token);e(window).bind("resize",function(){location.reload()})})})(jQuery);
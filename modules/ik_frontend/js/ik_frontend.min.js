/*jshint devel:true *//*jshint laxbreak:true*/// Define configuration object to get settings data from backend to frontend.
// Before calls are made to the backend.
var IKFrontend=IKFrontend||{settings:{}},IK=function(){"use strict";function n(e,t){this.propreties={};this.__construct(e,t)}function r(e){this.token=undefined;this.slides=[];this.currentSlide=0;this.timeout=undefined;this.__construct=function(e){this.token=e;this.fetchChannel()};this.fetchChannel=function(){a("Trying to fetch channel with token: "+this.token);$.ajax({type:"POST",context:this,url:"/channels/"+this.token+"/update",dataType:"JSON",success:function(e){this.processChannel(e)}})};this.processChannel=function(e){a("Channel with token "+this.token+" fetched.");var t=this;$.each(e,function(e,r){var i=new n(t.token,r.nid);t.slides.push(i)});$("body").ajaxStop(function(){a("All slides for the channel ("+t.token+") fechted");t.start()})};this.nextSlide=function(){var e=this,t=e.slides[e.currentSlide];t.render();this.timeout=setTimeout(function(){e.currentSlide++;if(e.currentSlide===e.slides.length){e.currentSlide=0;a("Restarting the channel to first slide")}e.nextSlide()},parseInt(t.get("exposure"),10))};this.start=function(){a("Starting the show");this.nextSlide()};this.stop=function(){a("Stopping the show");clearTimeout(this.timeout)};this.destory=function(){};this.__construct(e)}function i(e){t===undefined?t=new r(e):t.start()}function s(){t.stop()}function o(){t.destory()}function u(){e.debug=!e.debug;a("Debug: "+e.debug)}function a(t){e.debug===!0&&console.log(t)}var e={debug:!1,animateChange:!0,fullscreen:!0,orgImgAspect:[1920,1080]},t;n.prototype.__construct=function(e,t){this.token=e;this.sid=t;this.directive={".image-container li":{"medium<-media":{"img@src":"medium"}},".text-container@style":function(e){return"color:#"+e.context.text_color+";background-color:#"+e.context.color},".divider@style":function(e){return"border-color:#"+e.context.text_color},".slide-heading":"title",".slide-subheading":"subheading",".slide-text":"text",".logo-container img@src":"logo"};this.template=$("#pure-template").compile(this.directive);this.fetchSlide()};n.prototype.fetchSlide=function(){a("Trying to fetch slide: "+this.sid);$.ajax({type:"POST",url:"/channels/"+this.token+"/slide/"+this.sid,context:this,dataType:"JSON",success:function(e){this.processSlide(e)}})};n.prototype.processSlide=function(e){a("Slide "+this.sid+" fetched.");this.propreties=e};n.prototype.get=function(e){if(this.propreties[e]!==undefined)return this.propreties[e];a("Slide failed to get property: "+e);return undefined};n.prototype.startSkitter=function(){var t=this;$("#slide-container .image-container").skitter({animation:"cubeSize",orgImgAspect:e.orgImgAspect,fullscreen:e.fullscreen,numbers:!1,navigation:!1,label:!1,stop_over:!1,interval:t.get("exposure")/t.get("media").length-600,structure:'<div class="container_skitter"><div class="image"><a href=""><img class="image_main" /></a></div></div>'})};n.prototype.animateChange=function(t,n){var r=this;if(t.length===0){$("#slide-container").html(n);this.startSkitter();return}if(e.fullscreen===!0){var i=e.orgImgAspect[0]/e.orgImgAspect[1],s=$(window).width(),o=$(window).height();s/o<i?$(".box_skitter ul",n).find("img").height(o):$(".box_skitter ul",n).find("img").width(s)}$(".box_skitter ul",n).show();t.css("z-index",2);n.css("z-index",1);$("#slide-container").append(n);t.fadeOut(1500,function(){t.remove();r.startSkitter()})};n.prototype.render=function(){a("rendering da bitch!");var t=$(this.template(this.propreties));t.attr("id","slide-"+this.get("sid"));t.addClass(this.get("layout"));if(e.animateChange===!0)this.animateChange($("#slide-container .slide"),t);else{$("#slide-container").html(t);this.startSkitter()}if(this.get("layout")==="layout-3"){var n=$("#slide-container .text-container").height();$("#slide-container .text-container").css("margin-top","-"+n/2+"px")}a("Slide render: "+this.get("title"))};return{start:i,stop:s,destory:o,debug:u}}();(function(e){e(document).ready(function(){IK.debug();IK.start(IKFrontend.settings.token)})})(jQuery);